name: CMake

on: 
   push:
     branches: [ "master" ]
#    pull_request:
#      branches: [ "master" ]

env:
  # Customize the CMake build type here (Release, Debug, RelWithDebInfo, etc.)
  BUILD_TYPE: Release

jobs:
#  build-windows:
#     # The CMake configure and build commands are platform agnostic and should work equally well on Windows or Mac.
#     # You can convert this to a matrix build if you need cross-platform coverage.
#     # See: https://docs.github.com/en/free-pro-team@latest/actions/learn-github-actions/managing-complex-workflows#using-a-build-matrix
#     runs-on: windows-latest

#     steps:
#     - uses: actions/checkout@v3
    
#     - name: Install Qt
#       uses: jurplel/install-qt-action@v3
#       with:
#         aqtversion: '==2.1.*'
#         version: '6.5.0'
#         host: 'windows'
#         target: 'desktop'
#         arch: 'win64_mingw'
#         tools: 'tools_cmake'

#     - name: Check out Assimp repo
#       uses: actions/checkout@master
#       with:
#           repository: assimp/assimp
          
#     - name: Configure Assimp 
#       run: cmake -B assimp -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}

#     - name: Build and install Assimp
#       run: cmake --build assimp --config ${{env.BUILD_TYPE}} --install

#     - name: Configure CMake
#       # Configure CMake in a 'build' subdirectory. `CMAKE_BUILD_TYPE` is only required if you are using a single-configuration generator such as make.
#       # See https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html?highlight=cmake_build_type
#       run: cmake -B ${{github.workspace}} -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}

#     - name: Build
#       # Build your program with the given configuration
#       run: cmake --build ${{github.workspace}} --config ${{env.BUILD_TYPE}}

#     - name: Test
#       working-directory: ${{github.workspace}}
#       # Execute tests defined by the CMake configuration.
#       # See https://cmake.org/cmake/help/latest/manual/ctest.1.html for more detail
#       run: ctest -C ${{env.BUILD_TYPE}}
      
 build-linux:
    # The CMake configure and build commands are platform agnostic and should work equally well on Windows or Mac.
    # You can convert this to a matrix build if you need cross-platform coverage.
    # See: https://docs.github.com/en/free-pro-team@latest/actions/learn-github-actions/managing-complex-workflows#using-a-build-matrix
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    
#     - name: Cache Qt
#       id: cache-qt
#       uses: actions/cache@v3
#       env:
#         cache-name: cache-qt-linux
#       with:
#         # qt cache files are stored in `/home/runner/work/QtMeshEditor/Qt` on Linux/macOS
#         path: /home/runner/work/QtMeshEditor/Qt
#         key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('/home/runner/work/QtMeshEditor/Qt') }}
#         restore-keys: |
#           ${{ runner.os }}-build-${{ env.cache-name }}-
#           ${{ runner.os }}-build-
#           ${{ runner.os }}-
    
#     - name: Install Qt
#       if: steps.cache-qt-linux.outputs.cache-hit != 'true'
#       uses: jurplel/install-qt-action@v3
#       with:
#         aqtversion: '==2.1.*'
#         version: '6.5.0'
#         host: 'linux'
#         target: 'desktop'
#         arch: 'gcc_64'
#         tools: 'tools_cmake'


    - name: Check out Assimp repo
      uses: actions/checkout@master
      with:
          repository: assimp/assimp
          path: /home/runner/work/QtMeshEditor/QtMeshEditor/assimp

    - name: Cache Assimp
      id: cache-assimp-linux
      uses: actions/cache@v3
      env:
        cache-name: cache-assimp-linux
      with:
        # Assimp cache files are stored in `/home/runner/work/QtMeshEditor/assimp` on Linux/macOS
        path: /home/runner/work/QtMeshEditor/QtMeshEditor/assimp-build
        #key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('/home/runner/work/QtMeshEditor/QtMeshEditor/assimp') }}
        # Need to delete manually if needed to rebuild. Until I find a better solution for detecting changes in the assimp repo.
        key: ${{ runner.os }}-build-${{ env.cache-name }}
        restore-keys: |
          ${{ runner.os }}-build-${{ env.cache-name }}-
         
    - if: steps.cache-assimp-linux.outputs.cache-hit != 'true'
      name: Build Assimp repo
      run: echo 'not found'
#          |
#             cmake -B /home/runner/work/QtMeshEditor/QtMeshEditor/assimp-build -S /home/runner/work/QtMeshEditor/QtMeshEditor/assimp -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}
#             cd /home/runner/work/QtMeshEditor/QtMeshEditor/assimp-build/
#             make DESTDIR=./ install -j8
      
#     - name: Build and install Assimp
#       run: cmake --build assimp --config ${{env.BUILD_TYPE}}
      
#     - name: Download Artifacts
#       uses: actions/download-artifact@v3
      
#     - name: Configure CMake
#       # Configure CMake in a 'build' subdirectory. `CMAKE_BUILD_TYPE` is only required if you are using a single-configuration generator such as make.
#       # See https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html?highlight=cmake_build_type
#       run: cmake -B ${{github.workspace}} -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}

#     - name: Build
#       # Build your program with the given configuration
#       run: cmake --build ${{github.workspace}} --config ${{env.BUILD_TYPE}}

#     - name: Download Artifacts
#       uses: actions/download-artifact@v3
#       with:
#         path: ${{github.workspace}}/bin

#     - name: Test
#       working-directory: ${{github.workspace}}
#       # Execute tests defined by the CMake configuration.
#       # See https://cmake.org/cmake/help/latest/manual/ctest.1.html for more detail
#       run: ctest -C ${{env.BUILD_TYPE}}

#  build-macos:
#     # The CMake configure and build commands are platform agnostic and should work equally well on Windows or Mac.
#     # You can convert this to a matrix build if you need cross-platform coverage.
#     # See: https://docs.github.com/en/free-pro-team@latest/actions/learn-github-actions/managing-complex-workflows#using-a-build-matrix
#     runs-on: macos-latest

#     steps:
#     - uses: actions/checkout@v3
    
#     - name: Install Qt
#       uses: jurplel/install-qt-action@v3
#       with:
#         aqtversion: '==2.1.*'
#         version: '6.5.0'
#         host: 'mac'
#         target: 'desktop'
#         arch: 'clang_64'
#         tools: 'tools_cmake'
        
#     - name: Check out Assimp repo
#       uses: actions/checkout@master
#       with:
#           repository: assimp/assimp
          
#     - name: Build Assimp repo
#       run: cmake -B assimp -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}
      
#     - name: Build and install Assimp
#       run: cmake --build assimp --config ${{env.BUILD_TYPE}} --install

#     - name: Configure CMake
#       # Configure CMake in a 'build' subdirectory. `CMAKE_BUILD_TYPE` is only required if you are using a single-configuration generator such as make.
#       # See https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html?highlight=cmake_build_type
#       run: cmake -B ${{github.workspace}} -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}

#     - name: Build
#       # Build your program with the given configuration
#       run: cmake --build ${{github.workspace}} --config ${{env.BUILD_TYPE}}

#     - name: Test
#       working-directory: ${{github.workspace}}
#       # Execute tests defined by the CMake configuration.
#       # See https://cmake.org/cmake/help/latest/manual/ctest.1.html for more detail
#       run: ctest -C ${{env.BUILD_TYPE}}
